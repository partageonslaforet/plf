pipeline {
    agent any

    environment {
        GITHUB_TOKEN=credentials('Jenkins-Github-Token')
        IMAGE_NAME='plf-dev-app'
        IMAGE_VERSION='1.0'
        DEPLOYMENT_NAME='plf-dev-app'
        NAMESPACE_NAME='plf-dev'
        TAG_NAME='ghcr.io/partageonslaforet'
    }

    options {
        // This is required if you want to clean before build
        skipDefaultCheckout(true)
    }

    stages{


        stage("stage 1") {
            steps{
                echo "step 1"
                echo "end step 1"

            }
        }


        stage("Github checkout") {
            steps{

                checkout scmGit(branches: [[name: '*/docker-dev']], extensions: [], userRemoteConfigs: [[url: "https://github.com/partageonslaforet/plf.git"]])
                echo "Checkout ${env.JOB_NAME}..."

            }
        }


        stage("stage 2") {
            steps{
                echo "step 2"

            }
        }

        stage('Build docker image'){
            steps{

                sh 'docker build -t $IMAGE_NAME:$IMAGE_VERSION -f ./docker/dev/app/dockerfile.app .'
                echo "Checkout ${env.JOB_NAME}..."
            }
        }

        stage("stage 3") {
            steps{
                echo "step 3"

            }
        }


        stage('Login to GitHub'){
            steps{
                sh 'echo $GITHUB_TOKEN_PSW | docker login ghcr.io -u $GITHUB_TOKEN_USR --password-stdin'
                echo " ${env.JOB_NAME} Logged in to GitHub..."
            }
        }


        stage("stage 4") {
            steps{
                echo "step 4"

            }
        }





    }

}